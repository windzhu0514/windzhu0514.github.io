<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>博客 - ljc  | shell实用命令</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.1/css/bulma.min.css" />
    <link rel="stylesheet" href="https://ljc.space/css/blog.css" />
</head>
<body>

    
    <nav class="navbar is-fixed-top" role="navigation" aria-label="main navigation">
        <div class="navbar-brand">
            <a class="navbar-item" href="https://ljc.space/">Home</a>
        </div>
    </nav>
    

    
    <section class="hero is-info is-medium">
        <div class="hero-body" style="background-image: url(https://ljc.space/img/bg-blog.jpg);">
            <div class="container has-text-centered">
                <br>
                <h1 class="title is-size-1">
                    
                        shell实用命令
                    
                </h1>
                
            </div>
        </div>
    </section>


<div class="container">
    <div class="section">
    

<div class="columns">
    <div class="column is-9">
        <div class="tile is-child box">
            <div class="content">
                

<h2 id="常用命令">常用命令</h2>

<ul>
<li>linux机器自动登录</li>
</ul>

<pre><code class="language-shell">查询账号密码自动登录 （autossh.exp、login.sh、bus_robot_all.txt）
</code></pre>

<ul>
<li>xshell vim打开文件乱码</li>
</ul>

<pre><code class="language-shell">vi ~/.vimrc
let &amp;termencoding=&amp;encoding
set fileencodings=utf-8,gbk
</code></pre>

<ul>
<li>循环读取文件的每一行 （for逐行读和while逐行读是有区别的）</li>
</ul>

<pre><code class="language-shell"># 第一种写法
#!/bin/bash
while read line
do
    echo $line
done &lt; filename(待读取的文件名)

# 第二种写法 文件最后需要有一个空行
#!/bin/bash
cat filename(待读取的文件名) | while read line
do
    echo $line
done

# 第三种写法
for line in `cat filename(待读取的文件名)`
do
    echo $line
done

# for逐行读和while逐行读是有区别的,如:
cat file
1111
2222
3333 4444 555

cat file | while read line; do echo $line; done
1111
2222
3333 4444 555

for line in $(&lt;file); do echo $line; done
1111
2222
3333
4444
555
</code></pre>

<p>压缩解压</p>

<pre><code class="language-shell">tar -cvf 175.153.115.85.tar ./*.jpg
tar –xvf file.tar
</code></pre>

<p>文件、文件夹操作</p>

<pre><code class="language-shell">ls -l |grep &quot;^-&quot;|wc -l  #统计某文件夹下文件的个数
ls -l |grep &quot;^ｄ&quot;|wc -l # 统计某文件夹下目录的个数
# 统计/home/han目录(包含子目录)下的所有js文件则
ls -lR /home/han|grep js|wc -l 或 ls -l &quot;/home/han&quot;|grep &quot;js&quot;|wc -l

# windows下复制某个目录下所有文件到指定目录
for /r d:\1 %f in (*.txt) do copy &quot;%f&quot; d:\1 
# linux下复制某个目录下所有文件到指定目录
#!/bin/bash
for file in `ls -R ./test/*/*.jpg`
do 
    echo $file
    cp $file ./new/
done
</code></pre>

<h2 id="scp">scp</h2>

<p>复制当前目录下的所有jpg文件到dest_ip机器/home/images/目录下</p>

<pre><code class="language-shell">scp ./*.jpg username@dest_ip:/home/images/
</code></pre>

<p>复制dest_ip机器/work目录下的所有jpg文件到当前目录</p>

<pre><code class="language-shell">scp root@dest_ip:/work/*.jpg ./
</code></pre>

<h2 id="expect">expect</h2>

<p><strong>批量重命名</strong></p>

<pre><code class="language-shell">#!/usr/bin/expect -f
#  ./autossh.exp user password 192.168.199.1
set user [lrange $argv 0 0]
set password [lrange $argv 1 1]
set host [lrange $argv 2 2]
set port [lrange $argv 3 3]

spawn ssh $user@$host -p $port
set timeout 60 # 命令超时时间
# 模式是通常的C Shell风格的正规表达式。模式必须匹配当前进程的从上一个expect或者interact开始的所有输出(所以统配符*使用的非常)的普遍。但是，一旦输出超过2000个字节，前面的字符就会被忘记，这可以通过设定match_max的值来改变
match_max 100000 

expect {
    &quot;continue connecting&quot; {
        send -- &quot;yes\r&quot;

        expect {
            &quot;*?assword:*&quot; {
                send -- &quot;$password\r&quot;
            }
        }
    }
    &quot;*?password:*&quot; {
        send -- &quot;$password\r&quot;
    }
}

expect &quot;*#*&quot;
send &quot;cd /work \r&quot;
expect &quot;*#*&quot;
send &quot;ls \r&quot;
expect &quot;*#*&quot;
# 文件名hotel_robot\loginCaptchas\123_123.jpg 需添加单引号 防止转义
send &quot;rename 'hotel_robot\\loginCaptchas\\' 0 *.jpg \r&quot;
expect &quot;*#*&quot;
send &quot;exit \r&quot; # 退出登录
# 接收到标识子进程已经结束的eof字符，expect脚本退出
expect eof

#send -- &quot;echo -e 'set fileencodings=utf-8,ucs-bom,gb18030,gbk,gb2312,cp936\nset termencoding=utf-8\nset encoding=utf-8' &gt; ~/.vimrc\n&quot;
# 交互模式 保持登录状态
#interact
</code></pre>

<p><strong>批量下载文件</strong></p>

<pre><code class="language-shell">#!/usr/bin/expect -f
#  ./autossh.exp user password 192.168.199.1
set user [lrange $argv 0 0]
set password [lrange $argv 1 1]
set host [lrange $argv 2 2]
set port [lrange $argv 3 3]
set id [lrange $argv 4 4]

spawn scp -P $port $user@$host:/work/$id.tar ./captchas/
set timeout 30
match_max 100000

expect {
    &quot;continue connecting&quot; {
        send -- &quot;yes\r&quot;

        expect {
            &quot;*?assword:*&quot; {
                send -- &quot;$password\r&quot;
            }
        }
    }
    &quot;*?password:*&quot; {
        send -- &quot;$password\r&quot;
    }
}

send &quot;exit \r&quot;
expect eof

#send -- &quot;echo -e 'set fileencodings=utf-8,ucs-bom,gb18030,gbk,gb2312,cp936\nset termencoding=utf-8\nset encoding=utf-8' &gt; ~/.vimrc\n&quot;

#interact
</code></pre>

<p><strong>ssh 2次跳转</strong></p>

<pre><code class="language-shell">#!/usr/bin/expect -f
#  ./autossh.exp user password 192.168.199.1
set user [lrange $argv 0 0]
set password [lrange $argv 1 1]
set host [lrange $argv 2 2]
set port [lrange $argv 3 3]

#spawn ssh $user@$host -p $port
spawn ssh root@180.106.150.51
set timeout 30

expect {
    &quot;continue connecting&quot; {
        send -- &quot;yes\r&quot;

        expect {
            &quot;*?assword:*&quot; {
                send -- &quot;tc2018!@#\r&quot;
            }
        }
    }
    &quot;*?password:*&quot; {
        send -- &quot;tc2018!@#\r&quot;
    }
}
expect &quot;*#*&quot; {
    spawn ssh $user@$host -p $port
    expect {
        &quot;continue connecting&quot; {
            send -- &quot;yes\r&quot;

            expect {
                &quot;*?assword:*&quot; {
                    send -- &quot;$password\r&quot;
                }
            }
        }
        &quot;*?password:*&quot; {
            send -- $password\r&quot;
        }
    }
    
    expect &quot;*#*&quot; { 
        send &quot;cd /work/hotel_robot/logs \r&quot;
        expect &quot;*#*&quot;
        send &quot;ls \r&quot;
    }
    interact
}

#send -- &quot;echo -e 'set fileencodings=utf-8,ucs-bom,gb18030,gbk,gb2312,cp936\nset termencoding=utf-8\nset encoding=utf-8' &gt; ~/.vimrc\n&quot;
</code></pre>

<p><strong>ssh登录</strong></p>

<pre><code class="language-shell">#!/usr/bin/expect -f
set user [lrange $argv 0 0]
set password [lrange $argv 1 1]
set host [lrange $argv 2 2]
set port [lrange $argv 3 3]

spawn ssh $user@$host -p $port
set timeout 30
match_max 100000

expect {
    &quot;(yes/no)&quot; {
        send &quot;yes\r&quot;;exp_continue
    }
    &quot;*password:*&quot; {
        send &quot;$password\r&quot;
    }
}

expect &quot;*#*&quot; { 
    send &quot;cd /work/bus_robot/logs \r&quot;
    send &quot;ls \r&quot;
 }

#send -- &quot;echo -e 'set fileencodings=utf-8,ucs-bom,gb18030,gbk,gb2312,cp936\nset termencoding=utf-8\nset encoding=utf-8' &gt; ~/.vimrc\n&quot;

interact
</code></pre>

<p>shell中使用expect</p>

<pre><code class="language-shell">#服务器IP地址数组
ips=(
ip1...
ip2...
ip3...
...
)
#遍历数组
for ip in ${ips[*]}
do
    /usr/bin/expect&lt;&lt;-EOF   #shell中使用expect
    set timeout 90
    spawn ssh user@$ip
    expect &quot;passphrase&quot;
    send &quot;password\r&quot;
    expect &quot;user&quot;
    send &quot;cd /dir\r&quot;
    expect &quot;dir&quot;
    send &quot;cat file.properties\r&quot;
    expect &quot;propertiy&quot;
    exit
    interact
    expect eof
    EOF
done

</code></pre>

            </div>
        </div>
    </div>
    <div class="column is-3">
        <div class="card">
    <div class="card-content">
        <h1 class="title is-5">Tags</h1>
        <div class="tags">
        
        </div>          
    </div>
</div><br>
        <div class="card">
    <div class="card-content">
        <h1 class="title is-5">Archives</h1>
        
            <a href="https://ljc.space/archives/2018">2018</a> (1)<br>
        
    </div>
</div>

    </div>
</div>


    </div>
</div>

<footer class="footer has-background-grey-darker has-text-white">
    <div class="content has-text-centered">
        <p>
            <span class="icon is-large"><a href="https://blog.csdn.net/windzhu0514" class="mysocial"><i class="fab fa-bookmark fa-3x"></i></a></span>&nbsp;&nbsp;
            <span class="icon is-large"><a href="https://github.com/windzhu0514" class="mysocial"><i class="fab fa-github fa-3x"></i></a></span>&nbsp;&nbsp;
            <br><br>
            Copyright &copy; 博客 - ljc 2018 - Theme by <a href="https://jeffprod.com" class="mysocial">JeffProd.com</a>
            - <a class="mysocial" href="https://ljc.space/about">About</a>
        </p>
    </div>
</footer>

<script defer src="https://use.fontawesome.com/releases/v5.1.0/js/all.js"></script>
</body>
</html>
